@model CogsMinimizer.Models.HomeIndexViewModel
@{
    ViewBag.Title = "Home Page";
}

<div class="jumbotron">
    <h1>SubMinimizer</h1>
    <p class="lead">Helps you detect and delete the idle resources in you Azure subscriptions and save money</p>
    <p><a href="https://github.com/shklar/CogsMinimizer" class="btn btn-primary btn-lg">Learn more &raquo;</a></p>
</div>

<div class="row">
    @if (!Request.IsAuthenticated)
    {
        <div class="col-lg-4 thumbnail">
            <div class="caption">
                <h3>Sign-in to connect your Azure Subscription</h3>
                <div id="org"><a href='@Url.Action("SignIn", "Account")'><img src="~/Images/org.png" style="height:65px;width:350px;margin:0px" class="img-thumbnail" /></a></div>
            </div>
        </div>
    }
    else if (Model != null)
    {
        <table class="table table-striped table-condensed table-hover">
            <tr>
                <td>
                    <h4>Azure Subscription</h4>
                </td>
                <td>
                    <h4>Availability</h4>
                </td>
            </tr>
            @foreach (KeyValuePair<string, CogsMinimizer.Models.Subscription> entry in Model.UserSubscriptions)
            {
                var subscription = entry.Value as CogsMinimizer.Models.Subscription;
                <tr>
                    <td>
                        @subscription.DisplayName
                        <br />
                        &nbsp;&nbsp;<small>Subscription Id: @subscription.Id</small>
                       <!--
                        <br />
                        &nbsp;&nbsp;<small>Organization Id: @subscription.OrganizationId</small>
                       -->
                    </td>
                    <td>
                        @if (subscription.IsConnected)
                        {
                            
                            if (Model.UserCanManageAccessForSubscriptions.Contains(@subscription.Id))
                            {
                                @Html.ActionLink("Analyze", "Analyze", "Subscription",
                               new
                               {
                                   Id = @subscription.Id,
                                   OrganizationId = @subscription.OrganizationId,
                                   DisplayName = @subscription.DisplayName,
                                   ServicePrincipalObjectId = Model.UserOrganizations[@subscription.OrganizationId].objectIdOfCloudSenseServicePrincipal
                               },
                               new { @class = "btn btn-success btn-xs" })

                                <small>&nbsp;&nbsp;</small>

                                @Html.ActionLink("Disconnect", "Disconnect", "Subscription",
                               new
                               {
                                   Id = @subscription.Id,
                                   OrganizationId = @subscription.OrganizationId,
                                   ServicePrincipalObjectId = Model.UserOrganizations[@subscription.OrganizationId].objectIdOfCloudSenseServicePrincipal
                               },
                                    new { @class = "btn btn-danger btn-xs" })

                                <br />
                                <small>Connected By: @subscription.ConnectedBy </small>
                                <br />
                                <small>Connected On: @subscription.ConnectedOn </small>
                            }
                            if (@subscription.AzureAccessNeedsToBeRepaired)
                            {
                                <br />
                                <small>&nbsp;&nbsp; Azure access needs to be repaired: </small>
                                @Html.ActionLink("Repair", "RepairAccess", "Subscription",
                               new
                               {
                                   Id = @subscription.Id,
                                   OrganizationId = @subscription.OrganizationId,
                                   ServicePrincipalObjectId = Model.UserOrganizations[@subscription.OrganizationId].objectIdOfCloudSenseServicePrincipal
                               },
                                    new { @class = "btn btn-info btn-xs" })
                            }
                        }
                        else
                        {
                            if (Model.UserCanManageAccessForSubscriptions.Contains(@subscription.Id))
                            {


                                @Html.ActionLink("Connect", "Connect", "Subscription",
                               new
                               {
                                   Id = @subscription.Id,
                                   OrganizationId = @subscription.OrganizationId,
                                   ServicePrincipalObjectId = Model.UserOrganizations[@subscription.OrganizationId].objectIdOfCloudSenseServicePrincipal
                               },
                               new { @class = "btn btn-info btn-xs" })
                            }
                        }
                        @if (!Model.UserCanManageAccessForSubscriptions.Contains(@subscription.Id))
                        {
                            <text>(You do not have the required access for this subscription.)</text>
                        }
                    </td>
                </tr>
            }
        </table>
        if (Model.DisconnectedUserOrganizations.Count > 0)
        {
            <div class="alert alert-warning" role="alert">
                <h4> Didn't find the Azure subscription that you want to connect? </h4>
                <h5>
                    It could be in the @Model.DisconnectedUserOrganizations.Count other Organization(s) of which you're a member.
                    Click here to connect to all your Organizations (you will need to provide consent for each).
                </h5>
            </div>
        }
    }
</div>